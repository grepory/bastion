{
	"regions": "all",
	"copy-to": "all",
	"build-region": "us-east-1",
	"source-ami": "ami-6b1cd400",
	"ami-name": "Opsee-Bastion-{{clean-timestamp}}",
	"ami-description": "Opsee's Bastion Software",
	"instance-type":"t2.micro",
	"ssh-username":"core",
	"staging":"/tmp/staging",
	"ami-tags":[["opsee", "bastion"]],
	"prepare": [
		{
			"type":"scp",
			"from":"build/docker_config.json"
		},
		{
			"type":"scp",
			"from":"build/bastion-env.sh"
		},
		{
			"type":"shell",
			"instructions":[
				"sudo mkdir -p /etc/opsee",
				"sudo mv /tmp/staging/bastion-env.sh /etc/opsee/bastion-env.sh"
			]
		},
		{
			"type":"shell",
			"instructions":["mv /tmp/staging/docker_config.json /home/core/.dockercfg"]
		},
		{
			"type":"systemd",
			"unit-file":"build/nsqd.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/connector.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/shovel-discovery.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/shovel-results.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/nsqadmin.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/checker.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/monitor.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/discovery.service"
		},
		{
			"type":"waitfor",
			"test":"-n \"$(curl -s --retry 10 --retry-delay 5 http://localhost:4000/health_check)\""
		}
	],
	"reboot-before-build": false,
	"public": false,
	"cleanup": true
        {{#ci}}
        ,"cleanup-on-error": true
        {{/ci}}
}
