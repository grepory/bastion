{
	"region": "us-east-1",
	"source-ami": "ami-c36583a8",
	"ami-name": "Opsee-Bastion-{{clean-timestamp}}",
	"ami-description": "Opsee's Bastion Software",
	"instance-type":"t2.micro",
	"ssh-username":"core",
	"staging":"/tmp/staging",
	"ami-tags":[["sha", "{{git-rev}}"], ["release", "build"], ["opsee", "bastion"]],
	"prepare": [
		{
			"type":"scp",
			"from":"build/docker_config.json"
		},
		{
			"type":"shell",
			"instructions":["mv /tmp/staging/docker_config.json /home/core/.dockercfg"]
		},
		{
			"type":"systemd",
			"unit-file":"build/checker.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/connector.service"
		},
		{
			"type":"systemd",
			"unit-file":"build/nsqd.service"
		},
		{
			"type":"waitfor",
			"test":"-n \"$(curl -s --retry 10 --retry-delay 5 http://localhost:4000/health_status)\""
		}
	],
	"reboot-before-build": false,
	"public": false,
	"copy-to": "all",
	"cleanup": true
}
